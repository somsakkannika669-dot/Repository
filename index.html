<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XITER SHOP</title>

<style>
body {
    background:#0f0f0f;
    color:white;
    font-family:sans-serif;
    text-align:center;
    margin:0;
}
h1 { color:#00ffc3; margin-top:20px; }
.container { width:90%; max-width:500px; margin:auto; }
.card {
    background:#1a1a1a;
    padding:20px;
    margin:20px 0;
    border-radius:12px;
}
button {
    background:#00ffc3;
    border:none;
    padding:10px 15px;
    border-radius:8px;
    cursor:pointer;
    margin:5px;
}
button:hover { opacity:0.8; }
.cart {
    background:#141414;
    padding:20px;
    margin-top:30px;
    border-radius:12px;
}
input { margin:10px 0; }
.order-history {
    background:#1a1a1a;
    padding:20px;
    margin-top:30px;
    border-radius:12px;
}
</style>
</head>
<body>

<h1>üî• XITER SHOP üî•</h1>

<div class="container" id="product-list"></div>

<div class="cart">
    <h2>üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
    <ul id="cart-items"></ul>
    <h3>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó</h3>

    <button onclick="clearCart()">‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
    <button onclick="generateQR()">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (PromptPay)</button>

    <div id="qr-section"></div>

    <div id="payment-section" style="display:none;">
        <h3>üìé ‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</h3>
        <input type="file" id="slipUpload">
        <br>
        <button onclick="confirmPayment()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô</button>
    </div>
</div>

<div class="order-history">
    <h2>üì¶ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2>
    <ul id="order-list"></ul>
</div>

<script>

let cartItems = [];
let total = 0;

// ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
function loadProducts() {
    let products = [
        {name:"‡∏û‡∏≤‡πÅ‡∏ô‡∏• 97%", price:250},
        {name:"‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô", price:150}
    ];

    const container = document.getElementById("product-list");
    container.innerHTML = "";

    products.forEach(product => {
        container.innerHTML += `
            <div class="card">
                <h2>${product.name}</h2>
                <p>‡∏£‡∏≤‡∏Ñ‡∏≤: ${product.price} ‡∏ö‡∏≤‡∏ó</p>
                <button onclick="addToCart('${product.name}',${product.price})">
                ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>
            </div>
        `;
    });
}

function addToCart(name, price) {
    cartItems.push({name, price});
    renderCart();
}

function removeItem(index) {
    cartItems.splice(index,1);
    renderCart();
}

function clearCart() {
    cartItems = [];
    renderCart();
    document.getElementById("qr-section").innerHTML="";
    document.getElementById("payment-section").style.display="none";
}

function renderCart() {
    const cart = document.getElementById("cart-items");
    cart.innerHTML="";
    total=0;

    cartItems.forEach((item,index)=>{
        total+=item.price;
        cart.innerHTML+=`
            <li>
            ${item.name} - ${item.price} ‡∏ö‡∏≤‡∏ó
            <button onclick="removeItem(${index})">‡∏•‡∏ö</button>
            </li>
        `;
    });

    document.getElementById("total").textContent=total;
}

// ===== PromptPay QR =====
function generateQR() {

    if(total<=0){
        alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤");
        return;
    }

    const phoneNumber="YOUR_PHONE_NUMBER"; // üî• ‡πÉ‡∏™‡πà‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå‡∏Ñ‡∏∏‡∏ì

    let formattedPhone=phoneNumber.replace(/^0/,"66");

    let payload=
        "00020101021129370016A000000677010111"+
        "01130066"+formattedPhone+
        "5802TH5303764"+
        "54"+total.toString().length.toString().padStart(2,"0")+total+
        "6304";

    function crc16(s){
        let crc=0xFFFF;
        for(let c=0;c<s.length;c++){
            crc^=s.charCodeAt(c)<<8;
            for(let i=0;i<8;i++){
                crc=(crc&0x8000)?(crc<<1)^0x1021:crc<<1;
            }
        }
        return (crc&0xFFFF).toString(16).toUpperCase();
    }

    let finalPayload=payload+crc16(payload).padStart(4,"0");

    let qrURL="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data="+finalPayload;

    document.getElementById("qr-section").innerHTML=`
        <h3>üí∏ ‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞ ${total} ‡∏ö‡∏≤‡∏ó</h3>
        <img src="${qrURL}">
    `;

    document.getElementById("payment-section").style.display="block";
}

// ===== ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô =====
function confirmPayment(){

    let file=document.getElementById("slipUpload").files[0];

    if(!file){
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡πà‡∏≠‡∏ô");
        return;
    }

    let orders=JSON.parse(localStorage.getItem("orders"))||[];

    orders.push({
        items:cartItems,
        total:total,
        slip:file.name,
        date:new Date().toLocaleString()
    });

    localStorage.setItem("orders",JSON.stringify(orders));

    alert("‚úÖ ‡∏™‡πà‡∏á‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö");

    cartItems=[];
    renderCart();
    document.getElementById("qr-section").innerHTML="";
    document.getElementById("payment-section").style.display="none";
    document.getElementById("slipUpload").value="";

    loadOrders();
}

// ===== ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå =====
function loadOrders(){
    let orders=JSON.parse(localStorage.getItem("orders"))||[];
    let list=document.getElementById("order-list");
    list.innerHTML="";

    orders.forEach(order=>{
        list.innerHTML+=`
            <li>
            üïí ${order.date} <br>
            üí∞ ${order.total} ‡∏ö‡∏≤‡∏ó <br>
            üìé ‡∏™‡∏•‡∏¥‡∏õ: ${order.slip}
            <hr>
            </li>
        `;
    });
}

loadProducts();
loadOrders();

</script>

</body>
</html>
